<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="红黑树 RBT 1. 红黑树介绍 红黑树（Red-Black Tree）是一种自平衡的二叉查找树，它保证在最坏的情况下，基本动态集合操作的时间复杂度为 $O(\\log n)$ 。红黑树通过对节点着色，并在插入或删除节点时进行必要的调整，使树的高度始终保持在 $O(\\log n)$ 以内，从而保证了高效的查找、插入和删除操作。\n"><title>红黑树源码解析</title><link rel=canonical href=https://capriwits.com/post/red-black-tree-source-code-analysis/><link rel=stylesheet href=/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="红黑树源码解析"><meta property='og:description' content="红黑树 RBT 1. 红黑树介绍 红黑树（Red-Black Tree）是一种自平衡的二叉查找树，它保证在最坏的情况下，基本动态集合操作的时间复杂度为 $O(\\log n)$ 。红黑树通过对节点着色，并在插入或删除节点时进行必要的调整，使树的高度始终保持在 $O(\\log n)$ 以内，从而保证了高效的查找、插入和删除操作。\n"><meta property='og:url' content='https://capriwits.com/post/red-black-tree-source-code-analysis/'><meta property='og:site_name' content="Capriwits's site"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='BST'><meta property='article:published_time' content='2024-11-19T23:13:12+08:00'><meta property='article:modified_time' content='2024-11-19T23:13:12+08:00'><meta property='og:image' content='https://capriwits.com/post/red-black-tree-source-code-analysis/RedBlackTree-icon.png'><meta name=twitter:title content="红黑树源码解析"><meta name=twitter:description content="红黑树 RBT 1. 红黑树介绍 红黑树（Red-Black Tree）是一种自平衡的二叉查找树，它保证在最坏的情况下，基本动态集合操作的时间复杂度为 $O(\\log n)$ 。红黑树通过对节点着色，并在插入或删除节点时进行必要的调整，使树的高度始终保持在 $O(\\log n)$ 以内，从而保证了高效的查找、插入和删除操作。\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://capriwits.com/post/red-black-tree-source-code-analysis/RedBlackTree-icon.png'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu5425474801781991629.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🌹</span></figure><div class=site-meta><h1 class=site-name><a href=/>Capriwits's site</a></h1><h2 class=site-description>To see the world as it is and to love it.</h2></div></header><ol class=menu-social><li><a href=https://github.com/CapriWits target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto://hypocrite30@foxmail.com target=_blank title=Mail rel=me><!doctype html><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="212.795" height="220.59" viewBox="0 0 212.795 220.59" enable-background="new 0 0 212.795 220.59"><path fill="#f7b63e" d="M206.382 36.693v138.896c0 2.718-2.207 4.924-4.926 4.924H11.338c-2.719.0-4.925-2.206-4.925-4.924V36.693l73.042 69.448 26.943 25.612 26.941-25.612 73.043-69.448z"/><path fill="#10003b" d="M201.456 182.514H11.338c-3.819.0-6.925-3.106-6.925-6.925V36.694c0-.8.477-1.523 1.211-1.838.736-.315 1.588-.163 2.167.389l98.606 93.749 98.606-93.749c.579-.552 1.432-.704 2.167-.389.734.315 1.211 1.038 1.211 1.838v138.895C208.382 179.408 205.275 182.514 201.456 182.514M8.413 41.354v134.234c0 1.613 1.312 2.925 2.925 2.925h190.118c1.613.0 2.926-1.312 2.926-2.925V41.354l-96.606 91.848c-.771.734-1.984.734-2.756.0L8.413 41.354z"/><path fill="#ffd161" d="M206.382 36.693l-73.043 69.448-26.941 25.612-26.943-25.612L6.413 36.693c0-2.719 2.206-4.925 4.925-4.925h190.118C204.175 31.769 206.382 33.975 206.382 36.693"/><path fill="#10003b" d="M106.398 133.753c-.496.0-.993-.184-1.378-.551L5.035 38.143c-.397-.377-.622-.901-.622-1.449.0-3.818 3.107-6.925 6.925-6.925h190.118c3.82.0 6.926 3.107 6.926 6.925.0.548-.225 1.072-.622 1.449l-99.984 95.06C107.39 133.569 106.894 133.753 106.398 133.753M8.514 35.931l97.884 93.063 97.883-93.063c-.337-1.244-1.476-2.162-2.825-2.162H11.338C9.988 33.769 8.85 34.687 8.514 35.931M206.382 36.693h.01H206.382z"/><path fill="#f7b63e" d="M206.382 175.589c0 2.719-2.207 4.925-4.926 4.925H11.338c-2.719.0-4.925-2.206-4.925-4.925l73.042-69.447 26.943 25.611 26.941-25.611 73.043 69.447z"/><path fill="#10003b" d="M201.456 182.514H11.338c-3.818.0-6.925-3.106-6.925-6.925.0-.548.225-1.072.622-1.449l73.042-69.447c.772-.735 1.985-.735 2.756.0l25.565 24.301 25.563-24.301c.771-.735 1.984-.735 2.756.0l73.043 69.447c.398.377.622.901.622 1.449C208.382 179.408 205.275 182.514 201.456 182.514M8.514 176.352c.336 1.244 1.475 2.162 2.824 2.162h190.118c1.35.0 2.489-.918 2.826-2.162l-70.943-67.45-25.563 24.301c-.772.734-1.985.734-2.756.0l-25.565-24.301-70.941 67.45z"/><polygon fill="#ffd161" points="79.456,106.141 6.416,175.593 6.416,36.69"/><path fill="#10003b" d="M6.416 177.593c-.267.0-.534-.053-.788-.162-.735-.315-1.212-1.038-1.212-1.838V36.69c0-.8.477-1.523 1.211-1.838.736-.315 1.588-.162 2.167.389l73.04 69.451c.397.377.622.901.622 1.449s-.225 1.072-.622 1.449l-73.04 69.452C7.415 177.403 6.919 177.593 6.416 177.593m2-136.242v129.581l68.138-64.791L8.416 41.351z"/><path fill="#10003b" d="M152.941 47.313h-62.06c-1.104.0-2-.896-2-2s.896-2 2-2h62.06c1.104.0 2 .896 2 2 0 1.105-.89500000000001 2-2 2"/><path fill="#10003b" d="M80.293 47.313h-20.44c-1.105.0-2-.896-2-2s.895-2 2-2h20.44c1.104.0 2 .896 2 2 0 1.105-.896000000000001 2-2 2"/><path fill="#10003b" d="M19.219 129.813c-1.104.0-2-.896-2-2V91.12c0-1.105.896-2 2-2s2 .895 2 2v36.693C21.219 128.917 20.323 129.813 19.219 129.813"/></svg></a></li><li><a href=https://twitter.com/noctambulist30 target=_blank title=Twitter rel=me><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512"><style>.st0{fill:#0cf}.st1{fill-rule:evenodd;clip-rule:evenodd;fill:#fff}</style><g><g><g><path class="st0" d="M503.6277 98.9293c-15.8539 7.1724-33.3008 11.5266-50.4099 14.3986 8.1227-1.3628 20.0931-16.0676 24.8777-22.0133 7.3009-9.0701 13.3735-19.4058 16.7879-30.5663.4348-.8711.7665-1.9664-.1046-2.6269-1.0953-.4348-1.8006-.2122-2.6717.2241-19.0965 10.2326-38.8504 17.6575-59.8715 22.9113-1.7423.4363-3.0348.0-4.1301-1.0938-1.7408-1.9679-3.3785-3.8208-5.2328-5.3524-8.8355-7.5176-18.3165-13.4154-29.0048-17.7711-14.0355-5.7215-29.3694-8.1451-44.4853-7.1649-14.7064.9548-29.1497 5.1014-42.2035 11.9211-13.0806 6.8347-24.7522 16.3411-34.0464 27.8109-9.614 11.8628-16.7042 25.8744-20.3337 40.7227-3.504 14.3313-3.2171 28.5087-1.0788 42.997.3242 2.4013.1136 2.7255-2.0636 2.4013C167.4175 163.4898 99.2485 134.0606 43.912 71.0033c-2.4027-2.7375-3.7072-2.7375-5.6752.2107-24.2158 36.2953-12.4665 94.6127 17.7845 123.2694 4.0315 3.8208 8.1765 7.6416 12.6443 11.1262-1.6302.3347-21.7622-1.8454-39.7007-11.1262-2.4027-1.5182-3.6086-.647-3.8208 2.0785-.2226 3.9209.1121 7.5295.65 11.7851 4.6471 36.7928 30.1285 70.8273 65.0222 84.1052 4.145 1.7423 8.7249 3.2724 13.1942 4.0315-7.9524 1.7423-16.1409 2.99-38.9416 1.2058-2.8376-.5454-3.9209.8727-2.8376 3.5981 17.1345 46.6997 54.1186 60.5932 81.816 68.5098 3.7072.6485 7.4174.6485 11.1351 1.5197-.2227.3347-.4453.3347-.6575.6589-9.1881 14.0056-41.041 24.4295-55.8729 29.613-26.9756 9.4272-56.3481 13.6694-84.8568 10.8587-4.5634-.6694-5.5212-.6201-6.7585.0-1.2522.774-.1584 1.8633 1.306 3.0497 5.7872 3.8193 11.6746 7.2053 17.674 10.4792 18.1073 9.5946 36.9841 17.2346 56.7231 22.6872 101.939 28.1516 216.7675 7.4653 293.3088-68.583 60.1076-59.7206 81.1735-142.0775 81.1735-224.539.0-3.2276 3.8133-5.0102 6.0801-6.7122 15.6388-11.7508 28.068-25.8116 39.7336-41.5132 2.6209-3.5279 2.4595-6.6643 2.4595-7.9524.0-.2226.0-.4348.0-.4348C505.4955 97.6114 505.6569 98.0074 503.6277 98.9293z"/></g><g><path class="st1" d="M154.6851 458.9174c42.2722.0 2.0291.0.0.0 5.56299999999999.0-.224199999999996.0.0.0z"/></g><g><path class="st1" d="M154.6851 458.9174c-.656000000000006.0508000000000379-8.2363.0.0.0.0.0-1.31950000000001.0.0.0z"/></g><g><path class="st1" d="M171.4849 459.3537c0-.841200000000015 8.84139999999999.0.0.0.0-.436300000000017 1.0848.0.0.0z"/></g><g><path class="st1" d="M347.9839 50.2692c-.5484.4348-1.3075.4348-2.0651.0C346.6764 50.2692 347.4355 50.2692 347.9839 50.2692z"/></g></g></g></svg></a></li><li><a href=https://t.me/capriwits target=_blank title=Telegram rel=me><svg width="256" height="256" viewBox="0 0 256 256" preserveAspectRatio="xMidYMid"><title>Telegram</title><defs><linearGradient x1="50%" y1="277555756e-23%" x2="50%" y2="100%" id="telegramLinearGradient-1"><stop stop-color="#2aabee" offset="0"/><stop stop-color="#229ed9" offset="100%"/></linearGradient></defs><g><path d="M128 0C94.06.0 61.48 13.494 37.5 37.49 13.5 61.486.0 94.066.0 128s13.5 66.514 37.5 90.51C61.48 242.506 94.06 256 128 256s66.52-13.494 90.5-37.49c24-23.996 37.5-56.576 37.5-90.51s-13.5-66.514-37.5-90.51C194.52 13.494 161.94.0 128 0z" fill="url(#telegramLinearGradient-1)"/><path d="M57.94 126.6476c37.32-16.256 62.2-26.974 74.64-32.152 35.56-14.786 42.94-17.354 47.76-17.4408458C181.4 77.0376 183.76 77.2996 185.3 78.5456 186.58 79.5956 186.94 81.0156 187.12 82.0116 187.28 83.0076 187.5 85.2776 187.32 87.0496 185.4 107.2896 177.06 156.4056 172.82 179.0756 171.04 188.668 167.5 191.884 164.08 192.198 156.64 192.882 151 187.286 143.8 182.5676c-11.26-7.386-17.62-11.982-28.56-19.188C102.6 155.0516 110.8 150.4736 118 142.9936c1.88-1.958 34.64-31.748 35.26-34.45C153.34 108.2056 153.42 106.9456 152.66 106.2816 151.92 105.6156 150.82 105.8436 150.02 106.0236c-1.14000000000001.256-19.12 12.152-54 35.686C90.92 145.2176 86.3 146.9276 82.14 146.8376 77.58 146.7396 68.78 144.2536 62.24 142.1296 54.24 139.5236 47.86 138.1456 48.42 133.7196 48.7 131.4156 51.88 129.0576 57.94 126.6476z" fill="#fff"/></g></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/link/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友链</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#31-插在根节点上>3.1 插在根节点上</a></li><li><a href=#32-插入节点的父节点是黑色>3.2 插入节点的父节点是黑色</a></li><li><a href=#33-插入节点的父节点是红色>3.3 插入节点的父节点是红色</a><ol><li><a href=#331-叔叔节点是红色>3.3.1 叔叔节点是红色</a></li><li><a href=#332-叔叔节点是黑色且当前节点是其父节点的右孩子>3.3.2 叔叔节点是黑色，且当前节点是其父节点的右孩子</a></li><li><a href=#333-叔叔节点是黑色且当前节点是其父节点的左孩子>3.3.3 叔叔节点是黑色，且当前节点是其父节点的左孩子</a></li></ol></li></ol><ol><li><a href=#41-删除-红--黑-节点>4.1 删除 ”红“ + ”黑“ 节点</a></li><li><a href=#42-删除根节点>4.2 删除根节点</a></li><li><a href=#43-删除-黑--黑-节点>4.3 删除 “黑” + “黑” 节点</a><ol><li><a href=#431-兄弟节点为红色>4.3.1 兄弟节点为红色</a></li><li><a href=#432-兄弟节点为黑色兄弟节点的两个孩子都是黑色>4.3.2 兄弟节点为黑色，兄弟节点的两个孩子都是黑色</a></li><li><a href=#433-兄弟节点为黑色兄弟节点左孩子红色右孩子黑色>4.3.3 兄弟节点为黑色，兄弟节点左孩子红色，右孩子黑色</a></li><li><a href=#434-兄弟节点黑色兄弟节点右孩子红色左孩子任意颜色>4.3.4 兄弟节点黑色，兄弟节点右孩子红色，左孩子任意颜色</a></li></ol></li><li><a href=#删除操作总结>删除操作总结</a></li></ol><ol><li><a href=#一红黑树节点定义>一、红黑树节点定义</a></li><li><a href=#二红黑树定义>二、红黑树定义</a></li><li><a href=#三红黑树搜索>三、红黑树搜索</a></li><li><a href=#四左右旋转>四、左右旋转</a></li><li><a href=#五红黑树插入>五、红黑树插入</a></li><li><a href=#六红黑树删除>六、红黑树删除</a></li><li><a href=#七测试代码>七、测试代码</a></li><li><a href=#删除操作补充说明>删除操作补充说明</a><ol><li><a href=#双黑-null-节点无法平衡问题>双黑 null 节点无法平衡问题</a></li><li><a href=#解决双黑-null-节点平衡问题>解决双黑 null 节点平衡问题</a></li><li><a href=#jdk-treemap-实现删除操作>JDK TreeMap 实现删除操作</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/red-black-tree-source-code-analysis/><img src=/post/red-black-tree-source-code-analysis/RedBlackTree-icon_hu8142298554966409257.png srcset="/post/red-black-tree-source-code-analysis/RedBlackTree-icon_hu8142298554966409257.png 800w, /post/red-black-tree-source-code-analysis/RedBlackTree-icon_hu14442032935254849201.png 1600w" width=800 height=800 loading=lazy alt="Featured image of post 红黑树源码解析"></a></div><div class=article-details><header class=article-category><a href=/categories/data-structure/>Data Structure</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/red-black-tree-source-code-analysis/>红黑树源码解析</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 19, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 19 分钟</time></div></footer></div></header><section class=article-content><h1 id=红黑树-rbt>红黑树 RBT</h1><p><img src=/post/red-black-tree-source-code-analysis/RBT.png width=995 height=477 srcset="/post/red-black-tree-source-code-analysis/RBT_hu13848729129674105955.png 480w, /post/red-black-tree-source-code-analysis/RBT_hu15406939028831737266.png 1024w" loading=lazy alt=RBT class=gallery-image data-flex-grow=208 data-flex-basis=500px></p><h1 id=1-红黑树介绍>1. 红黑树介绍</h1><p>红黑树（Red-Black Tree）是一种自平衡的二叉查找树，它保证在最坏的情况下，基本动态集合操作的时间复杂度为 $O(\log n)$
。红黑树通过对节点着色，并在插入或删除节点时进行必要的调整，使树的高度始终保持在 $O(\log n)$ 以内，从而保证了高效的查找、插入和删除操作。</p><p>红黑树的广泛的应用</p><ul><li>JDK 1.8 开始，<code>HashMap</code> 也引入了红黑树：当冲突的链表长度超过 8 时，自动转为红黑树</li><li>Java 中，<code>TreeMap</code>、<code>TreeSet</code> 都使用红黑树作为底层数据结构</li><li>Linux 底层的 完全公平调度器 (CFS) 进程调度算法中，vruntime 使用红黑树进行存储。</li><li>多路复用技术的 <code>Epoll</code>，其核心结构是红黑树 + 双向链表。</li></ul><h1 id=2-红黑树的定义和性质>2. 红黑树的定义和性质</h1><p>红黑树的每个节点都包含一个颜色属性，颜色可以是红色或黑色。红黑树的定义遵循以下五个定义：</p><ol><li><strong>每个节点要么是红色，要么是黑色</strong>。</li><li><strong>根节点必须是黑色</strong>。</li><li><strong>叶子节点都是黑色的空节点（NIL），即每个叶子节点都是一个特殊的黑色节点，没有存储实际数据</strong>。</li><li><strong>如果一个节点是红色的，则它的两个子节点都必须是黑色的</strong>。（不能有两个连续的红色节点）</li><li><strong>对每个节点，从该节点到 NIL 节点的所有路径上都包含相同数量的黑色节点</strong>。</li></ol><p>这些性质确保了红黑树的高度始终保持对数增长，从而使查找、插入和删除操作的时间复杂度为 $O(\log n)$。</p><p>性质：</p><ul><li>从根到叶子的最长的可能路径不多于最短的可能路径的两倍长<ul><li>最短路径为全黑节点；最长为红黑相间，黑色首尾；</li><li>最短路径 <code>k</code> 个黑节点，而最长路径是 <code>2k - 1</code></li></ul></li></ul><h1 id=3-红黑树插入>3. 红黑树插入</h1><h2 id=31-插在根节点上>3.1 插在根节点上</h2><p>直接把该节点染黑（作为根节点</p><h2 id=32-插入节点的父节点是黑色>3.2 插入节点的父节点是黑色</h2><p>什么都不做（节点为红色</p><h2 id=33-插入节点的父节点是红色>3.3 插入节点的父节点是红色</h2><h3 id=331-叔叔节点是红色>3.3.1 叔叔节点是红色</h3><p>四步做完后，需要从祖父节点继续向上递归</p><ol><li>父节点染黑</li><li>叔叔节点染黑</li><li>祖父节点染红</li><li>祖父节点设为当前节点（红色节点，即之后对当前节点进行操作，递归向上做一样的判断，直到叔叔节点不是红色</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-insert-1.png width=331 height=632 srcset="/post/red-black-tree-source-code-analysis/RBT-insert-1_hu8162664562678204116.png 480w, /post/red-black-tree-source-code-analysis/RBT-insert-1_hu10264102352370467349.png 1024w" loading=lazy alt=RBT-insert-1.png class=gallery-image data-flex-grow=52 data-flex-basis=125px></p><h3 id=332-叔叔节点是黑色且当前节点是其父节点的右孩子>3.3.2 叔叔节点是黑色，且当前节点是其父节点的右孩子</h3><p>该情况无法直接处理，需要左旋后，跳转至 3.3.3</p><ol><li>将父节点作为新的当前节点</li><li>以新的当前节点为支点左旋</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-insert-2.png width=350 height=644 srcset="/post/red-black-tree-source-code-analysis/RBT-insert-2_hu7344963155243576426.png 480w, /post/red-black-tree-source-code-analysis/RBT-insert-2_hu6093179279571726339.png 1024w" loading=lazy alt=RBT-insert-2.png class=gallery-image data-flex-grow=54 data-flex-basis=130px></p><h3 id=333-叔叔节点是黑色且当前节点是其父节点的左孩子>3.3.3 叔叔节点是黑色，且当前节点是其父节点的左孩子</h3><ol><li>父节点染黑</li><li>祖父节点染红</li><li>以祖父节点为支点右旋</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-insert-3.png width=374 height=961 srcset="/post/red-black-tree-source-code-analysis/RBT-insert-3_hu7376853214482168290.png 480w, /post/red-black-tree-source-code-analysis/RBT-insert-3_hu1762888970068527341.png 1024w" loading=lazy alt=RBT-insert-3.png class=gallery-image data-flex-grow=38 data-flex-basis=93px></p><h1 id=4-红黑树删除>4. 红黑树删除</h1><h2 id=41-删除-红--黑-节点>4.1 删除 ”红“ + ”黑“ 节点</h2><p>待删除节点有一红一黑两个子节点（NIL 为黑色也包括在内）</p><p>直接将红色的子节点染黑即可</p><h2 id=42-删除根节点>4.2 删除根节点</h2><p>根节点必然为黑色</p><p>直接将根节点染为黑即可</p><h2 id=43-删除-黑--黑-节点>4.3 删除 “黑” + “黑” 节点</h2><h3 id=431-兄弟节点为红色>4.3.1 兄弟节点为红色</h3><p>有兄弟节点，说明当前节点不是根节点，前面讨论过根节点被删除情况，后面同理。</p><ol><li>兄弟节点染黑</li><li>父节点染红</li><li>父节点左旋</li><li>左旋后，重新设置兄弟节点为当前节点</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-delete-1.png width=510 height=967 srcset="/post/red-black-tree-source-code-analysis/RBT-delete-1_hu5868979890909020235.png 480w, /post/red-black-tree-source-code-analysis/RBT-delete-1_hu10112353450832648179.png 1024w" loading=lazy alt=RBT-delete-1.png class=gallery-image data-flex-grow=52 data-flex-basis=126px></p><h3 id=432-兄弟节点为黑色兄弟节点的两个孩子都是黑色>4.3.2 兄弟节点为黑色，兄弟节点的两个孩子都是黑色</h3><ol><li>兄弟节点染红</li><li>将父节点设为新的当前节点</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-delete-2.png width=447 height=635 srcset="/post/red-black-tree-source-code-analysis/RBT-delete-2_hu17465947656672303630.png 480w, /post/red-black-tree-source-code-analysis/RBT-delete-2_hu8221194478321782209.png 1024w" loading=lazy alt=RBT-delete-2.png class=gallery-image data-flex-grow=70 data-flex-basis=168px></p><h3 id=433-兄弟节点为黑色兄弟节点左孩子红色右孩子黑色>4.3.3 兄弟节点为黑色，兄弟节点左孩子红色，右孩子黑色</h3><ol><li>兄弟节点左孩子染黑</li><li>兄弟节点染红</li><li>兄弟节点右旋</li><li>右旋后，更新旋转后的 N 的兄弟节点，即从 S 变成 C</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-delete-3.png width=432 height=1026 srcset="/post/red-black-tree-source-code-analysis/RBT-delete-3_hu3615395693477176130.png 480w, /post/red-black-tree-source-code-analysis/RBT-delete-3_hu15262638764234665114.png 1024w" loading=lazy alt=RBT-delete-3.png class=gallery-image data-flex-grow=42 data-flex-basis=101px></p><h3 id=434-兄弟节点黑色兄弟节点右孩子红色左孩子任意颜色>4.3.4 兄弟节点黑色，兄弟节点右孩子红色，左孩子任意颜色</h3><ol><li>父节点颜色赋值给兄弟节点</li><li>父节点染黑</li><li>兄弟节点右孩子染黑</li><li>父节点左旋</li><li>达到平衡，当前节点设为红黑树根节点即可，不再循环，已平衡</li></ol><p><img src=/post/red-black-tree-source-code-analysis/RBT-delete-4.png width=375 height=966 srcset="/post/red-black-tree-source-code-analysis/RBT-delete-4_hu5999166104427124905.png 480w, /post/red-black-tree-source-code-analysis/RBT-delete-4_hu16142739252191597029.png 1024w" loading=lazy alt=RBT-delete-4.png class=gallery-image data-flex-grow=38 data-flex-basis=93px></p><h2 id=删除操作总结>删除操作总结</h2><p>4.3.1 只会执行一次，变成 2/3/4 三种情况</p><p>4.3.2 每执行一次，都会向上递归，最多执行 $log(n)$ 次，递归过程可能再遇到情况一，所以 4.3.1 也是最多 $log(n)$ 次</p><p>4.3.3 执行，会变成情况四；情况四 只会执行一次</p><h1 id=红黑树源码>红黑树源码</h1><h2 id=一红黑树节点定义>一、红黑树节点定义</h2><p><code>RBT</code> 是个二叉树，同时还需要有颜色，颜色只有红黑两种情况，因此简单使用布尔值表示；</p><p>额外维护父节点 <code>parent</code>，因为插入删除需要找到兄弟或叔叔节点，需要向上遍历；</p><p>默认插入节点就是红色，原因在于：红黑树性质 5 节点到子孙节点所有路径包含相同数量黑节点，因此插入红色节点，就直接满足性质 5</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Node</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>left</span><span class=p>,</span><span class=w> </span><span class=n>right</span><span class=p>,</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=n>red</span><span class=p>;</span><span class=w>  </span><span class=c1>// 是否为红色节点, 默认为红色(false)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Node</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>val</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=二红黑树定义>二、红黑树定义</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RedBlackTree</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 节点颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>RED</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=三红黑树搜索>三、红黑树搜索</h2><p>就是普通二叉树的搜索</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=nf>search</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>val</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>val</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>val</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>val</span><span class=p>)</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=四左右旋转>四、左右旋转</h2><p>该版本的左右旋转是带 <code>parent</code> 节点更新的，需要注意顺序</p><p>定义 <code>x</code> 是相对于 <code>y</code> 的左侧，例如左旋，则当前节点为 <code>x</code>，右旋则当前节点是 <code>y</code></p><p><img src=/post/red-black-tree-source-code-analysis/RBT-right-rotate.png width=862 height=378 srcset="/post/red-black-tree-source-code-analysis/RBT-right-rotate_hu11531610014770283287.png 480w, /post/red-black-tree-source-code-analysis/RBT-right-rotate_hu4320371810869620092.png 1024w" loading=lazy alt=RBT-right-rotate.png class=gallery-image data-flex-grow=228 data-flex-basis=547px> <img src=/post/red-black-tree-source-code-analysis/RBT-left-rotate.png width=764 height=384 srcset="/post/red-black-tree-source-code-analysis/RBT-left-rotate_hu2838426040826231976.png 480w, /post/red-black-tree-source-code-analysis/RBT-left-rotate_hu7394245709984994320.png 1024w" loading=lazy alt=RBT-left-rotate.png class=gallery-image data-flex-grow=198 data-flex-basis=477px></p><p>以左旋为例，整体从下到上更新，这样不会丢失指针。</p><ol><li>先改 <code>ly.parent = x</code></li><li>然后将 <code>y</code> 转上去，即修改 <code>px</code> 的孩子，如果 px 为空，该树根节点就是 y；同时修改 <code>y.parent = px</code></li><li>最后更新 <code>y</code> 的孩子，<code>y.left = x</code>, <code>x.parent = y</code>；</li></ol><blockquote><p>3 不能在 2 之前，是因为需要通过 <code>x.parent</code> 找到老的 <code>px</code>，否则 <code>x.parent</code> 改为 <code>y</code> 后，就找不到 <code>px</code> 了</p></blockquote><p>右旋就是左旋的镜像操作</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>leftRotate</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>rightRotate</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=五红黑树插入>五、红黑树插入</h2><details><summary>红黑树插入源码</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 插入节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>insert</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Node</span><span class=p>(</span><span class=n>val</span><span class=p>);</span><span class=w> </span><span class=c1>// 新节点, 默认红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>z</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RED</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=p>;</span><span class=w>  </span><span class=c1>// y 为 z 父节点(起始为空), x 为当前节点, 遍历从 x 根节点开始</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>z</span><span class=p>.</span><span class=na>val</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>val</span><span class=p>)</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// x 位置为 z 待插入位置, y 是其父节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>;</span><span class=w>  </span><span class=c1>// z 插入为根节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>z</span><span class=p>.</span><span class=na>val</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>val</span><span class=p>)</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 插入后的调整</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>insertFixUp</span><span class=p>(</span><span class=n>z</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 插入后调整</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>insertFixUp</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>z</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 插入节点的父节点为红色, 需要调整(父节点为黑色什么都不做)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// z 父节点是祖父节点的左孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>uncle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 1. 叔叔节点红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>uncle</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>uncle</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>      </span><span class=c1>// 父节点染黑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>uncle</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>         </span><span class=c1>// 叔叔节点染黑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RED</span><span class=p>;</span><span class=w> </span><span class=c1>// 祖父节点染红</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>       </span><span class=c1>// 祖父节点作为新节点继续调整</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 2. 叔叔节点黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>z</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 2.1 z 是右孩子, 需要左旋到一条直线, 在 2.2 继续处理</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>           </span><span class=c1>// 对父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>z</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 2.2 叔叔节点黑色, z 是左孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>        </span><span class=c1>// 父节点染黑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RED</span><span class=p>;</span><span class=w>   </span><span class=c1>// 祖父节点染红</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=c1>// 祖父节点右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// z 父节点是祖父节点的右孩子(右侧即左侧的镜像操作)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>uncle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>uncle</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>uncle</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>       </span><span class=c1>// 父节点染黑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>uncle</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>          </span><span class=c1>// 叔叔节点染黑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RED</span><span class=p>;</span><span class=w>  </span><span class=c1>// 祖父节点染红</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>        </span><span class=c1>// 祖父节点作为新节点继续调整</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>z</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>z</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>           </span><span class=c1>// 对父节点右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>z</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>       </span><span class=c1>// 父节点染黑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RED</span><span class=p>;</span><span class=w>  </span><span class=c1>// 祖父节点染红</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>z</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=c1>// 祖父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>  </span><span class=c1>// 需要保证根节点为黑色(z 插在根节点上, 需染黑)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><h2 id=六红黑树删除>六、红黑树删除</h2><ul><li>先创建一些辅助方法<ul><li><code>transplant</code>，可以替换节点，主要用于 <code>delete</code> 节点时，将后继节点替换目标节点</li><li><code>successor</code>，可以找到节点的中序遍历较大节点值，即 <code>successor(node)</code></li><li><code>getColor</code>，获取节点颜色，多封装一层 <code>NIL</code> 节点判定为黑色</li><li><code>setColor</code>，设置节点颜色，判空，防止空指针</li></ul></li></ul><details><summary>辅助方法源码</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 替换节点, v 替换 u, 只替换父索引, 不替换子索引</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>transplant</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>u</span><span class=p>,</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=n>v</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>u</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>v</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>u</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 寻找子树的最小节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=nf>successor</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>node</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 获取节点的颜色, 若节点为 null 则默认为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>getColor</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 设置节点的颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setColor</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>color</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>color</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><p>删除后的平衡调整，<code>deleteFixup</code> 方法，入参除了待调整节点 <code>x</code>，还有其父节点 <code>parent</code>，该 <code>parent</code> 存在意义在后面解释</p><details><summary>红黑树删除操作源码</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>search</span><span class=p>(</span><span class=n>val</span><span class=p>);</span><span class=w>        </span><span class=c1>// 待删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>  </span><span class=c1>// 待删除节点不存在</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>       </span><span class=c1>// y 替换 node 节点, x 记录可能影响平衡的子树, parent 是 node 直接后续节点替换后 x 的父节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=n>originalColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>  </span><span class=c1>// y 原始颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>  </span><span class=c1>// 右孩子替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>);</span><span class=w>   </span><span class=c1>// 左孩子替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 找 node 直接后续节点, 替换 node 为 y(颜色与 node 同色)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>minimum</span><span class=p>(</span><span class=n>node</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>originalColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>             </span><span class=c1>// y 会从右子树移除, 受影响平衡的是 y 的右子树</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// y 是 node 的直接右孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>          </span><span class=c1>// 此时 x 可能是 null, 但 x 的父节点就是替换 node 的 y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>                 </span><span class=c1>// y 不是 node 的直接右孩子, y 右孩子替换 y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transplant</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w>  </span><span class=c1>// y 替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>  </span><span class=c1>// 清空 node 引用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>originalColor</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=c1>// y 从右子树移除到 node, 原来的 y 是黑色则需要调整(红色不影响性质)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>deleteFixup</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>node</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 删除后, 从 x 向上修复
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param x      修复起点, 可能为 null
</span></span></span><span class=line><span class=cl><span class=cm> * @param parent x 的父节点
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteFixup</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=n>parent</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>        </span><span class=c1>// x 是左孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>     </span><span class=c1>// w 是 x 的兄弟节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>      </span><span class=c1>// 将 w 变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 x 的父节点变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>    </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>      </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>     </span><span class=c1>// 继续从父节点向上修复</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>  </span><span class=c1>// 更新 parent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的右孩子是黑色，左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 上面判断过都为黑色, 只要右孩子是黑色, 左孩子就是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将 w 的左孩子变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>              </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>                </span><span class=c1>// 对 w 右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>            </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4 可能由情况3 转化而来</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>parent</span><span class=p>));</span><span class=w> </span><span class=c1>// 将 w 设为父节点的颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将父节点设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>        </span><span class=c1>// 将 w 的右孩子设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>            </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>                        </span><span class=c1>// 修复完成，将 x 设为根节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果 x 是右孩子，和左孩子的操作对称，交换左右操作即可</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的左孩子是黑色，右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>parent</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w> </span><span class=c1>// 将最终的 x 设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><h2 id=七测试代码>七、测试代码</h2><details><summary>验证红黑树是否符合性质</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>verifyRBTProperties</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>verifyProperty1</span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>verifyProperty2</span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>verifyProperty4</span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>verifyProperty5</span><span class=p>(</span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>verifyProperty6</span><span class=p>(</span><span class=n>root</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 红黑树的性质1：每个节点是红色或黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>verifyProperty1</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>  </span><span class=c1>// null 节点视为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>!</span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>verifyProperty1</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>verifyProperty1</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 红黑树的性质2：根节点是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>verifyProperty2</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>root</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 红黑树的性质3：每个叶子节点都是黑色的空节点 null(不用验证)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 红黑树的性质4：每个红色节点的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>verifyProperty4</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>verifyProperty4</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>verifyProperty4</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 红黑树的性质5：从任一节点到其每个叶子节点的路径都包含相同数目的黑色节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>verifyProperty5</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>blackHeight</span><span class=p>(</span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 验证是否为二叉搜索树, 中序遍历结果递增</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>verifyProperty6</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>values</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>inOrderTraversal</span><span class=p>(</span><span class=n>root</span><span class=p>,</span><span class=w> </span><span class=n>values</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>values</span><span class=p>.</span><span class=na>size</span><span class=p>();</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>values</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>values</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Inorder traversal is not increasing: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>values</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 中序遍历，将节点值添加到列表中</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>inOrderTraversal</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=n>values</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>inOrderTraversal</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>values</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>values</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>val</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>inOrderTraversal</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>values</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 计算黑高，如果黑高不一致则返回-1，代表红黑树不合法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>blackHeight</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>  </span><span class=c1>// null 节点作为黑节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>leftBlackHeight</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blackHeight</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>rightBlackHeight</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>blackHeight</span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>leftBlackHeight</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>rightBlackHeight</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>leftBlackHeight</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>rightBlackHeight</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>leftBlackHeight</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>  </span><span class=c1>// 红节点不计入黑高</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><details><summary>打印红黑树</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>printTree</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>root</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>root</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>Node</span><span class=o>&gt;</span><span class=w> </span><span class=n>queue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LinkedList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>queue</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>root</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>queue</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queue</span><span class=p>.</span><span class=na>size</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>queue</span><span class=p>.</span><span class=na>poll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>pos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s>&#34; LE&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#34; RI&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>pstr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>val</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>cstr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s>&#34;R&#34;</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=s>&#34;B&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>cstr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>cstr</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>cstr</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; &#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>n</span><span class=p>.</span><span class=na>val</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;(&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>cstr</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>pstr</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>pos</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;)&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\t&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=n>queue</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>n</span><span class=p>.</span><span class=na>left</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>n</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=n>queue</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>n</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><details><summary>主函数</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Solution</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 红黑树插入验证
</span></span></span><span class=line><span class=cl><span class=cm>         */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RedBlackTree</span><span class=w> </span><span class=n>tree</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RedBlackTree</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>valuesToInsert</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getRamdomIntArray</span><span class=p>(</span><span class=n>100</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;插入操作：&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>valuesToInsert</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tree</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;插入 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; 后的树结构：&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tree</span><span class=p>.</span><span class=na>printTree</span><span class=p>(</span><span class=n>tree</span><span class=p>.</span><span class=na>root</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;验证插入后的树结构是否满足红黑树性质：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tree</span><span class=p>.</span><span class=na>verifyRBTProperties</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n-------------------------&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * 红黑树删除验证
</span></span></span><span class=line><span class=cl><span class=cm>         */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RedBlackTree</span><span class=w> </span><span class=n>tree2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RedBlackTree</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>valuesToInsert</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tree2</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;删除操作：&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>valuesToDelete</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getRamdomIntArray</span><span class=p>(</span><span class=n>50</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>valuesToDelete</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tree2</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;删除 &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; 后的树结构：&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>tree2</span><span class=p>.</span><span class=na>printTree</span><span class=p>(</span><span class=n>tree2</span><span class=p>.</span><span class=na>root</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;验证删除后的树结构是否满足红黑树性质：&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>tree2</span><span class=p>.</span><span class=na>verifyRBTProperties</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n-------------------------&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 生成随机指定长度随机 int 数组</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=nf>getRamdomIntArray</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Random</span><span class=w> </span><span class=n>random</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Random</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>arr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>int</span><span class=o>[</span><span class=n>size</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>arr</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>random</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>1000</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&#34;arr: {&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>size</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>arr</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&#34;, &#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;}&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>arr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><h2 id=删除操作补充说明>删除操作补充说明</h2><h3 id=双黑-null-节点无法平衡问题>双黑 null 节点无法平衡问题</h3><p>下面删除操作，在左右孩子都不空的条件下，后继节点 <code>y</code> 会替换 <code>node</code>，而 <code>y</code> 的右孩子会替换 <code>y</code>；</p><p>如果 <code>y</code> 是 <code>node</code> 的直接右孩子，且 <code>y</code> 的右孩子是 <code>null</code>，在删除后的调整后，<code>deleteFixup</code> 的入参 <code>x</code> 是 <code>null</code>，一方面会影响到
<code>x</code> 找到兄弟节点（空指针异常），另一方面 <code>x</code> 作为 <code>null</code>，失去 <code>parent</code> 的引用，双黑节点无法向上平衡调整。</p><details><summary>双黑 null 节点无法平衡问题源码</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>search</span><span class=p>(</span><span class=n>val</span><span class=p>);</span><span class=w>        </span><span class=c1>// 待删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>  </span><span class=c1>// 待删除节点不存在</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>  </span><span class=c1>// y 替换 node 节点, x 记录可能影响平衡的子树</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=n>originalColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>  </span><span class=c1>// y 原始颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>  </span><span class=c1>// 右孩子替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>);</span><span class=w>   </span><span class=c1>// 左孩子替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>successor</span><span class=p>(</span><span class=n>node</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>originalColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// y 是 node 的直接右孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// y 是 node 直接右孩子, 不需要处理右侧逻辑</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>    </span><span class=c1>// y 不是 node 的直接右孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// y 右孩子替换 y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transplant</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w>  </span><span class=c1>// y 替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>originalColor</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=c1>// y 是黑色, 从下面替换到上面的 node, 需要调整(红色不影响性质)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>deleteFixup</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>node</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 删除后调整</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteFixup</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>        </span><span class=c1>// x 是左孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>     </span><span class=c1>// w 是 x 的兄弟节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>      </span><span class=c1>// 将 w 变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 x 的父节点变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>    </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>      </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>     </span><span class=c1>// 继续从父节点向上修复</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的右孩子是黑色，左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 上面判断过都为黑色, 只要右孩子是黑色, 左孩子就是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将 w 的左孩子变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>              </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>                </span><span class=c1>// 对 w 右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>            </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4 可能由情况3 转化而来</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>));</span><span class=w> </span><span class=c1>// 将 w 设为父节点的颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将父节点设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>        </span><span class=c1>// 将 w 的右孩子设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>            </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>                        </span><span class=c1>// 修复完成，将 x 设为根节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果 x 是右孩子，和左孩子的操作对称，交换左右操作即可</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的左孩子是黑色，右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w> </span><span class=c1>// 将最终的 x 设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><p>用以下 case 可以测出空指针问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>valuesToInsert</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>10</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>,</span><span class=w> </span><span class=n>30</span><span class=p>,</span><span class=w> </span><span class=n>15</span><span class=p>,</span><span class=w> </span><span class=n>25</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>valuesToDelete</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>30</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>};</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>删除 30 后的树结构：
20(B)
10(R 20 LE) 25(B 20 RI)
5(B 10 LE) 15(B 10 RI)
1(R 5 LE)</p></blockquote><p>删除 20 时，直接后继是 25，25 替换 20 后，没办法让 25 的右子树 <code>x</code> 替换 25，因为 <code>x</code> 是 <code>null</code>，无法指定 <code>parent</code>，且后续还需要针对
<code>x</code> 进行平衡操作，因此 <code>x</code> 作为双黑节点无法找到父节点和兄弟节点而无法平衡操作</p><h3 id=解决双黑-null-节点平衡问题>解决双黑 null 节点平衡问题</h3><p>相较于有问题的版本，给 <code>deleteFixup</code> 额外添加一个 <code>parent</code> 参数，用来表示 <code>x</code> 的父引用，这样即使在调整双黑 <code>null</code>
节点，也能顺利找到父节点和兄弟节点。</p><p>除此之外，<code>deleteFixup</code> 还需要额外添加 <code>parent</code> 的更新，例如情况 2，<code>x</code> 向 <code>parent</code> 移动，<code>parent</code> 引用也需要更新</p><details><summary>解决双黑 null 节点平衡问题源码</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>search</span><span class=p>(</span><span class=n>val</span><span class=p>);</span><span class=w>        </span><span class=c1>// 待删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>  </span><span class=c1>// 待删除节点不存在</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>       </span><span class=c1>// y 替换 node 节点, x 记录可能影响平衡的子树, parent 是 node 直接后续节点替换后 x 的父节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=n>originalColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>  </span><span class=c1>// y 原始颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>  </span><span class=c1>// 右孩子替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>);</span><span class=w>   </span><span class=c1>// 左孩子替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 找 node 直接后续节点, 替换 node 为 y(颜色与 node 同色)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>successor</span><span class=p>(</span><span class=n>node</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>originalColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>             </span><span class=c1>// y 会从右子树移除, 受影响平衡的是 y 的右子树</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// y 是 node 的直接右孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>          </span><span class=c1>// 此时 x 可能是 null, 但 x 的父节点就是替换 node 的 y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>                 </span><span class=c1>// y 不是 node 的直接右孩子, y 右孩子替换 y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>transplant</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>y</span><span class=p>.</span><span class=na>right</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>transplant</span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>);</span><span class=w>  </span><span class=c1>// y 替换 node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>left</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>y</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>red</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>node</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>node</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>  </span><span class=c1>// 清空 node 引用</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>originalColor</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=c1>// y 从右子树移除到 node, 原来的 y 是黑色则需要调整(红色不影响性质)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>deleteFixup</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>node</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 删除后, 从 x 向上修复
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param x      修复起点, 可能为 null
</span></span></span><span class=line><span class=cl><span class=cm> * @param parent x 的父节点
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteFixup</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>Node</span><span class=w> </span><span class=n>parent</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>        </span><span class=c1>// x 是左孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>     </span><span class=c1>// w 是 x 的兄弟节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>      </span><span class=c1>// 将 w 变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 x 的父节点变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>    </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>      </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>     </span><span class=c1>// 继续从父节点向上修复</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>  </span><span class=c1>// 更新 parent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的右孩子是黑色，左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 上面判断过都为黑色, 只要右孩子是黑色, 左孩子就是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将 w 的左孩子变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>              </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>                </span><span class=c1>// 对 w 右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>            </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4 可能由情况3 转化而来</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>parent</span><span class=p>));</span><span class=w> </span><span class=c1>// 将 w 设为父节点的颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将父节点设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>        </span><span class=c1>// 将 w 的右孩子设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>            </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>                        </span><span class=c1>// 修复完成，将 x 设为根节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果 x 是右孩子，和左孩子的操作对称，交换左右操作即可</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的左孩子是黑色，右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>parent</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w> </span><span class=c1>// 将最终的 x 设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><p>当然，也可以增加一个哨兵节点 <code>NIL = new Node()</code> ，不让叶子结点为 <code>null</code>，从而可以保存父引用，代码需要将所有的 <code>null</code> 判断全部改成
<code>NIL</code> 引用的判断，但是也增加了插入操作的复杂性。</p><h3 id=jdk-treemap-实现删除操作>JDK TreeMap 实现删除操作</h3><p>参考 JDK 21 里的 <code>java.util.TreeMap#deleteEntry</code> 删除红黑树节点操作</p><p>TreeMap 删除操作：</p><ol><li>待删除节点 <code>p</code>，如果左右孩子都存在，则找直接后继节点 <code>s</code>，<code>s</code> 值替换 <code>p</code>，然后 <code>p</code> 下移到 <code>s</code></li><li><code>replacement</code> 是 <code>p</code> 的左右非空子节点（左子树优先），<code>p</code> 可能是待删除节点，也可能是值替换后下移的后继节点 <code>s</code>。而后续的操作都是针对
<code>replacement</code> 删除，再调整平衡。该后续操作无论针对删除原节点 <code>p</code>，还是已经值替换到上面 <code>p</code> 的后继节点 <code>s</code>（<code>s</code> 替换 <code>p</code> 后
<code>s</code> 从 <code>p</code> 右子树移除），这一删除都是成立的。</li><li><code>replacement</code> 不空，则代表 <code>replacement</code> 可以直接替换 <code>p</code>。注意，此时 <code>replacement</code> 是 <code>p</code> 的左右孩子其一，且非空，而 <code>p</code>
的另一个孩子必然为空。<ol><li>解释：如果 <code>p</code> 有两个非空孩子，则其会在一开始就会进入第一个 <code>if</code>，找到后继节点并值替换。然而找到的后继节点 <code>s</code>
左孩子必然是空的（否则会继续向左孩子遍历），只有可能有非空右孩子。而 <code>p</code> 一开始就没有两个非空孩子，则至多只有一个非空孩子，保证
<code>replacement</code> 取到一个非空孩子并进入 <code>if (replacement != null)</code> 块中</li><li>论证 <code>p</code> 有且仅有一个孩子 <code>replacement</code> 非空（左右不重要），就可以直接将 <code>replacement</code> 替换 <code>p</code>，且只需要修改
<code>replacement</code> 父引用和 <code>p.parent</code> 子引用，不需要考虑 <code>replacement</code> 的另一个兄弟（<code>null</code>），直接简化了删除操作，变成一个单一链路的替换，而不考虑
<code>p</code> 可能同时被两个孩子替代</li></ol></li><li>下面都是 <code>p</code> 无孩子情况<ul><li>替换的 <code>p</code> 是根节点，直接将 <code>root</code> 置空（<code>null</code> 替换根节点）</li><li><code>p</code> 非父节点，注释中提到用 <code>p</code> 作为幻影替换自身，即什么都不做，先进行删除后的平衡，然后将父节点的子引用调节为 <code>null</code>
，实现 <code>p</code> 被替换的同时，也能平衡红黑树</li></ul></li></ol><details><summary>TreeMap 删除操作源码</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>val</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>search</span><span class=p>(</span><span class=n>val</span><span class=p>);</span><span class=w>        </span><span class=c1>// 待删除节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=p>;</span><span class=w>       </span><span class=c1>// 待删除节点不存在</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Node</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>successor</span><span class=p>(</span><span class=n>p</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>p</span><span class=p>.</span><span class=na>val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=na>val</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=c1>// p has 2 children</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Start fixup at replacement node, if it exists.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Node</span><span class=w> </span><span class=n>replacement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>right</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>replacement</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Link replacement to parent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>replacement</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>replacement</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>replacement</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>replacement</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Null out links so they are OK to use by fixAfterDeletion.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>p</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Fix replacement</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>deleteFixup</span><span class=p>(</span><span class=n>replacement</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// return if we are the only node.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>root</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>//  No children. Use self as phantom replacement and unlink.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>red</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>deleteFixup</span><span class=p>(</span><span class=n>p</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>p</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>p</span><span class=p>.</span><span class=na>parent</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 删除后调整</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteFixup</span><span class=p>(</span><span class=n>Node</span><span class=w> </span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>root</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>        </span><span class=c1>// x 是左孩子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>     </span><span class=c1>// w 是 x 的兄弟节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>      </span><span class=c1>// 将 w 变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 x 的父节点变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>    </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>      </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w> </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>     </span><span class=c1>// 继续从父节点向上修复</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的右孩子是黑色，左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>  </span><span class=c1>// 上面判断过都为黑色, 只要右孩子是黑色, 左孩子就是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将 w 的左孩子变成黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>              </span><span class=c1>// 将 w 变成红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>                </span><span class=c1>// 对 w 右旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>right</span><span class=p>;</span><span class=w>            </span><span class=c1>// 旋转后，更新兄弟节点 w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4 可能由情况3 转化而来</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>));</span><span class=w> </span><span class=c1>// 将 w 设为父节点的颜色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>       </span><span class=c1>// 将父节点设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>        </span><span class=c1>// 将 w 的右孩子设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>            </span><span class=c1>// 对 x 的父节点左旋</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>                        </span><span class=c1>// 修复完成，将 x 设为根节点</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 如果 x 是右孩子，和左孩子的操作对称，交换左右操作即可</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Node</span><span class=w> </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况1：x 的兄弟节点 w 是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>RED</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 情况2：x 的兄弟节点 w 是黑色，且 w 的两个子节点都是黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况3：w 是黑色，且 w 的左孩子是黑色，右孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>getColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>BLACK</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>right</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>RED</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>leftRotate</span><span class=p>(</span><span class=n>w</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>w</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>.</span><span class=na>left</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 情况4：w 是黑色，且 w 的左孩子是红色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>,</span><span class=w> </span><span class=n>getColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>setColor</span><span class=p>(</span><span class=n>w</span><span class=p>.</span><span class=na>left</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>rightRotate</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=na>parent</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>root</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>setColor</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>BLACK</span><span class=p>);</span><span class=w> </span><span class=c1>// 将最终的 x 设为黑色</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></details><p>总结 <code>TreeMap</code> 删除操作精妙之处：</p><ol><li><code>BST</code> 的删除可能删除原节点 <code>p</code>，也可能删除后继节点 <code>s</code>（<code>p</code> 被 <code>s</code> 替换，<code>s</code> 需要从 <code>p</code> 的右子树删除）。方法开始就处理 <code>p</code>
有两孩的情况，下面的后继 <code>s</code> 值替换后，<code>p</code> 会下移至 <code>s</code> ，p 就变成<strong>单孩</strong>或<strong>无孩</strong></li><li>接下来才进行真正的引用替换，只需要进行简单的两节点（<code>p.parent</code>, <code>replacement</code> ）修改引用即可，而不涉及两孩争抢 <code>p</code> 的问题</li></ol><h1 id=reference>Reference</h1><ul><li><a class=link href=https://www.bilibili.com/video/BV1Ar4y1Q7Js target=_blank rel=noopener>https://www.bilibili.com/video/BV1Ar4y1Q7Js</a></li><li><a class=link href=https://oi-wiki.org/ds/rbtree target=_blank rel=noopener>https://oi-wiki.org/ds/rbtree</a></li><li><a class=link href=https://tech.meituan.com/2016/12/02/redblack-tree.html target=_blank rel=noopener>https://tech.meituan.com/2016/12/02/redblack-tree.html</a></li><li><a class=link href=https://jingyuexing.github.io/Ebook/Algorithm/ target=_blank rel=noopener>https://jingyuexing.github.io/Ebook/Algorithm/</a>算法导论.pdf<ul><li>《算法导论》第二版在线版，第 13 章 红黑树</li></ul></li></ul><p>源码实现大部分参照《算法导论》：</p><ul><li><a class=link href=https://www.cnblogs.com/skywang12345/p/3245399.html target=_blank rel=noopener>https://www.cnblogs.com/skywang12345/p/3245399.html</a></li><li><a class=link href=https://www.cnblogs.com/skywang12345/p/3624343.html target=_blank rel=noopener>https://www.cnblogs.com/skywang12345/p/3624343.html</a></li><li>Java JDK TreeMap - <a class=link href=https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/TreeMap.java target=_blank rel=noopener>https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/java/util/TreeMap.java</a></li></ul><p>非常详细的红黑树删除演示：</p><ul><li><a class=link href=https://www.bilibili.com/video/BV16m421u7Tb target=_blank rel=noopener>https://www.bilibili.com/video/BV16m421u7Tb</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/bst/>BST</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Capriwits's site</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>